# SadTalker é›†æˆä½¿ç”¨æŒ‡å—

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

LEXIé¡¹ç›®ç°å·²é›†æˆSadTalkeråŠŸèƒ½ï¼Œå¯ä»¥å°†DeepSeek AIçš„æ–‡æœ¬å›å¤è½¬æ¢ä¸ºé€¼çœŸçš„è¯´è¯äººè„¸è§†é¢‘ã€‚é€šè¿‡ç»“åˆæ–‡æœ¬è½¬è¯­éŸ³(TTS)æŠ€æœ¯å’ŒSadTalkerçš„AIé©±åŠ¨é¢éƒ¨åŠ¨ç”»ï¼Œä¸ºå®éªŒå‚ä¸è€…æä¾›æ›´åŠ ç”ŸåŠ¨çš„AIäº’åŠ¨ä½“éªŒã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ¤– **AIæ–‡æœ¬è½¬è§†é¢‘** - å°†DeepSeekçš„æ–‡æœ¬å›å¤è‡ªåŠ¨è½¬æ¢ä¸ºè¯´è¯è§†é¢‘
- ğŸ—£ï¸ **æ–‡æœ¬è½¬è¯­éŸ³** - ä½¿ç”¨OpenAI TTSå°†æ–‡æœ¬è½¬æ¢ä¸ºè‡ªç„¶è¯­éŸ³
- ğŸ‘¤ **è‡ªå®šä¹‰å¤´åƒ** - å…è®¸ç”¨æˆ·ä¸Šä¼ è‡ªå·±çš„å¤´åƒç…§ç‰‡
- ğŸ›ï¸ **çµæ´»æ§åˆ¶** - å®éªŒç®¡ç†å‘˜å¯é€šè¿‡æ§åˆ¶å°å†³å®šæ˜¯å¦å¯ç”¨åŠŸèƒ½
- ğŸ“± **å“åº”å¼è®¾è®¡** - åœ¨æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯éƒ½æœ‰ä¼˜åŒ–çš„ç”¨æˆ·ä½“éªŒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡

1. **ç¡®ä¿SadTalkerå·²éƒ¨ç½²**
   ```bash
   # SadTalkeråº”è¯¥ä½äºé¡¹ç›®æ ¹ç›®å½•
   ls ../SadTalker/inference.py
   ```

2. **å®‰è£…SadTalkerä¾èµ–**
   ```bash
   cd ../SadTalker
   pip install -r requirements.txt
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   # åœ¨server/.envä¸­æ·»åŠ 
   OPENAI_API_KEY=your_openai_api_key_here
   ```

### å¯ç”¨åŠŸèƒ½

1. **å¯åŠ¨æœåŠ¡å™¨**
   ```bash
   cd server
   npm run dev
   ```

2. **è¿è¡Œæµ‹è¯•è„šæœ¬**
   ```bash
   cd server
   node test-sadtalker.js
   ```

3. **åœ¨Adminæ§åˆ¶å°ä¸­é…ç½®å®éªŒ**
   - è¿›å…¥Adminé¢æ¿
   - åˆ›å»ºæˆ–ç¼–è¾‘å®éªŒ
   - åœ¨"SadTalker Settings"éƒ¨åˆ†å¯ç”¨ç›¸å…³åŠŸèƒ½

## ğŸ”§ å®éªŒé…ç½®

### SadTalkerè®¾ç½®é€‰é¡¹

åœ¨å®éªŒè¡¨å•ä¸­ï¼Œæ‚¨å¯ä»¥é…ç½®ä»¥ä¸‹é€‰é¡¹ï¼š

- **Enable SadTalker Video Generation** - å¯ç”¨è§†é¢‘ç”ŸæˆåŠŸèƒ½
- **Allow Custom Avatar Upload** - å…è®¸å—è¯•è€…ä¸Šä¼ è‡ªå®šä¹‰å¤´åƒ
- **Auto-play Generated Videos** - è‡ªåŠ¨æ’­æ”¾ç”Ÿæˆçš„è§†é¢‘

### é…ç½®ç¤ºä¾‹

```javascript
experimentFeatures: {
    userAnnotation: false,
    streamMessage: true,
    sadTalker: {
        enabled: true,          // å¯ç”¨SadTalker
        customAvatar: true,     // å…è®¸è‡ªå®šä¹‰å¤´åƒ
        autoPlay: true          // è‡ªåŠ¨æ’­æ”¾è§†é¢‘
    }
}
```

## ğŸ“‹ ä½¿ç”¨æµç¨‹

### å¯¹äºå®éªŒç®¡ç†å‘˜

1. **é…ç½®å®éªŒ**
   - åœ¨Adminæ§åˆ¶å°ä¸­åˆ›å»ºæ–°å®éªŒ
   - å¯ç”¨SadTalkerç›¸å…³è®¾ç½®
   - æ ¹æ®éœ€è¦é…ç½®è‡ªå®šä¹‰å¤´åƒå’Œè‡ªåŠ¨æ’­æ”¾é€‰é¡¹

2. **ç›‘æ§æœåŠ¡**
   - è®¿é—® `/sadtalker/health` ç«¯ç‚¹æ£€æŸ¥æœåŠ¡çŠ¶æ€
   - æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ç¡®è®¤è§†é¢‘ç”Ÿæˆæƒ…å†µ

### å¯¹äºå®éªŒå‚ä¸è€…

1. **ä¸Šä¼ å¤´åƒ**ï¼ˆå¦‚æœå¯ç”¨äº†è‡ªå®šä¹‰å¤´åƒï¼‰
   - åœ¨èŠå¤©é¡µé¢å·¦ä¾§è¾¹æ æ‰¾åˆ°"Custom Avatar"
   - ç‚¹å‡»"Upload Avatar"æŒ‰é’®
   - é€‰æ‹©æ¸…æ™°çš„äººè„¸ç…§ç‰‡ï¼ˆå»ºè®®æ­£é¢ç…§ï¼‰

2. **å¼€å§‹å¯¹è¯**
   - æ­£å¸¸å‘é€æ¶ˆæ¯ç»™AI
   - AIå›å¤æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆè¯´è¯è§†é¢‘
   - è§†é¢‘ä¼šæ˜¾ç¤ºåœ¨æ–‡æœ¬æ¶ˆæ¯ä¸Šæ–¹

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æ ¸å¿ƒç»„ä»¶

1. **TTSæœåŠ¡** (`tts.service.ts`)
   - ä½¿ç”¨OpenAI TTS APIå°†æ–‡æœ¬è½¬æ¢ä¸ºè¯­éŸ³
   - æ”¯æŒå¤šç§å£°éŸ³é€‰æ‹©
   - è¾“å‡ºMP3æ ¼å¼éŸ³é¢‘

2. **SadTalkeræœåŠ¡** (`sadtalker.service.ts`)
   - è°ƒç”¨SadTalker Pythonè„šæœ¬
   - å¤„ç†å›¾ç‰‡å’ŒéŸ³é¢‘è¾“å…¥
   - ç”Ÿæˆè¯´è¯è§†é¢‘å¹¶è¿”å›base64ç¼–ç 

3. **å¯¹è¯æœåŠ¡æ‰©å±•** (`conversations.service.ts`)
   - é›†æˆTTSå’ŒSadTalkerè°ƒç”¨
   - åœ¨AIå›å¤åè‡ªåŠ¨ç”Ÿæˆè§†é¢‘
   - æ”¯æŒæµå¼å’Œéæµå¼æ¶ˆæ¯

4. **å‰ç«¯ç»„ä»¶**
   - `TalkingVideoPlayer.tsx` - è§†é¢‘æ’­æ”¾å™¨
   - `AvatarUploader.tsx` - å¤´åƒä¸Šä¼ ç»„ä»¶
   - `Message.tsx` - æ‰©å±•æ¶ˆæ¯æ˜¾ç¤º

### æ•°æ®æµ

```
ç”¨æˆ·æ¶ˆæ¯ â†’ DeepSeek API â†’ æ–‡æœ¬å›å¤ â†’ TTSæœåŠ¡ â†’ éŸ³é¢‘æ–‡ä»¶ â†’ SadTalker â†’ è¯´è¯è§†é¢‘ â†’ å‰ç«¯æ˜¾ç¤º
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **SadTalkeræœåŠ¡ä¸å¯ç”¨**
   ```bash
   # æ£€æŸ¥SadTalkerç›®å½•
   ls ../SadTalker/
   
   # æ£€æŸ¥Pythonç¯å¢ƒ
   python --version
   
   # å®‰è£…ä¾èµ–
   cd ../SadTalker && pip install -r requirements.txt
   ```

2. **TTSæœåŠ¡å¤±è´¥**
   ```bash
   # æ£€æŸ¥APIå¯†é’¥
   echo $OPENAI_API_KEY
   
   # åœ¨.envæ–‡ä»¶ä¸­è®¾ç½®
   OPENAI_API_KEY=your_key_here
   ```

3. **è§†é¢‘ç”Ÿæˆç¼“æ…¢**
   - ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç³»ç»Ÿèµ„æº
   - è€ƒè™‘ä½¿ç”¨GPUåŠ é€Ÿ
   - è°ƒæ•´è§†é¢‘å°ºå¯¸è®¾ç½®

4. **å¤´åƒä¸Šä¼ å¤±è´¥**
   - æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆ<5MBï¼‰
   - ç¡®ä¿æ˜¯æœ‰æ•ˆçš„å›¾ç‰‡æ ¼å¼
   - éªŒè¯ç½‘ç»œè¿æ¥

### æ€§èƒ½ä¼˜åŒ–

1. **GPUåŠ é€Ÿ**
   ```bash
   # æ£€æŸ¥CUDAå¯ç”¨æ€§
   python -c "import torch; print(torch.cuda.is_available())"
   ```

2. **ç¼“å­˜ä¼˜åŒ–**
   - è€ƒè™‘ç¼“å­˜ç”Ÿæˆçš„è§†é¢‘
   - å®ç°å¤´åƒé¢„å¤„ç†

3. **å¹¶å‘æ§åˆ¶**
   - é™åˆ¶åŒæ—¶ç”Ÿæˆçš„è§†é¢‘æ•°é‡
   - å®ç°é˜Ÿåˆ—ç³»ç»Ÿ

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### å¥åº·æ£€æŸ¥

è®¿é—®ä»¥ä¸‹ç«¯ç‚¹æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š

- `GET /sadtalker/health` - æœåŠ¡å¥åº·çŠ¶æ€
- `GET /sadtalker/default-avatar` - é»˜è®¤å¤´åƒè·å–

### æ—¥å¿—ç›‘æ§

é‡è¦çš„æ—¥å¿—ä¿¡æ¯ï¼š

```bash
# SadTalkerç”Ÿæˆæ—¥å¿—
"Generating talking video for message..."

# TTSç”Ÿæˆæ—¥å¿—
"Generating speech for text: ..."

# æœåŠ¡å¥åº·æ£€æŸ¥
"SadTalker health check: OK"
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

1. **æ–‡ä»¶ä¸Šä¼ å®‰å…¨**
   - éªŒè¯æ–‡ä»¶ç±»å‹å’Œå¤§å°
   - é˜²æ­¢æ¶æ„æ–‡ä»¶ä¸Šä¼ 

2. **èµ„æºé™åˆ¶**
   - é™åˆ¶è§†é¢‘ç”Ÿæˆé¢‘ç‡
   - ç›‘æ§CPU/å†…å­˜ä½¿ç”¨

3. **æ•°æ®éšç§**
   - åŠæ—¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶
   - ä¿æŠ¤ç”¨æˆ·ä¸Šä¼ çš„å¤´åƒ

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (åˆå§‹ç‰ˆæœ¬)
- âœ… é›†æˆSadTalkerè§†é¢‘ç”Ÿæˆ
- âœ… OpenAI TTSæ”¯æŒ
- âœ… è‡ªå®šä¹‰å¤´åƒä¸Šä¼ 
- âœ… å®éªŒé…ç½®æ§åˆ¶
- âœ… å“åº”å¼UIè®¾è®¡

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®æ”¹è¿›å»ºè®®ï¼š

1. æŠ¥å‘Šbugå’Œé—®é¢˜
2. æå‡ºåŠŸèƒ½è¯·æ±‚
3. æäº¤ä»£ç æ”¹è¿›
4. å®Œå–„æ–‡æ¡£

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜è¯·è”ç³»ï¼š
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
- è¿è¡Œæµ‹è¯•è„šæœ¬
- æ£€æŸ¥æœåŠ¡çŠ¶æ€
- æäº¤issue

---

ğŸ‰ äº«å—æ›´ç”ŸåŠ¨çš„AIå¯¹è¯ä½“éªŒï¼ 